// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema
// NOTE: I am not sure whether this schema works on a fresh database created via the seed script! I think the @@map annotations might have to be deleted as I later renamed the tables in the Prisma schema using this approach without changing the DB

generator client {
    provider        = "prisma-client-js"
    previewFeatures = ["filteredRelationCount"]
}

datasource db {
    provider = "sqlite"
    url      = env("DATABASE_URL")
}

model Example {
    id        String   @id @default(cuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model Artist {
    id           String             @id @default(cuid())
    name         String
    genres       String
    imgUrl       String?
    thumbnailUrl String?
    tracks       TrackArtistEntry[]
    albums       AlbumArtistEntry[]
}

model Album {
    id                   String             @id @default(cuid())
    name                 String
    type                 String
    releaseDate          DateTime
    releaseDatePrecision String
    imgUrl               String?
    thumbnailUrl         String?
    artists              AlbumArtistEntry[]
    tracks               Track[]
    label                String
}

model AlbumArtistEntry {
    artistId String
    artist   Artist @relation(fields: [artistId], references: [id])
    rank     Int
    albumId  String
    album    Album  @relation(fields: [albumId], references: [id])

    @@id([artistId, albumId], name: "albumFeatureId")
}

model TrackArtistEntry {
    artistId String
    artist   Artist @relation(fields: [artistId], references: [id])
    rank     Int
    trackId  String
    track    Track  @relation(fields: [trackId], references: [id])

    @@id([artistId, trackId], name: "trackFeatureId")
}

model Track {
    id                  String              @id @default(cuid())
    name                String
    featuringArtists    TrackArtistEntry[]
    countryChartEntries CountryChartEntry[]
    globalChartEntries  GlobalChartEntry[]
    explicit            Boolean
    previewUrl          String?
    albumId             String
    album               Album               @relation(fields: [albumId], references: [id])
    isrc                String
    isrcYear            Int
    isrcAgency          String
    isrcTerritory       String
    danceability        Float
    energy              Float
    key                 Float
    loudness            Float
    mode                Int
    speechiness         Float
    acousticness        Float
    instrumentalness    Float
    liveness            Float
    valence             Float
    tempo               Float
    durationMs          Float
    timeSignature       Int
}

model Country {
    name         String              @id @default(cuid())
    isoAlpha3    String
    isoAlpha2    String
    geoRegion    String
    geoSubregion String
    chartEntries CountryChartEntry[]

    @@map("Region") // every Spotify Region that is not the Global region is actually a Country, so this should be called Country, but I realized later and don't want to break my existing DB for now lol
}

model CountryChartEntry {
    id          String   @id @default(cuid())
    country     Country  @relation(fields: [countryName], references: [name])
    countryName String   @map("regionName")
    track       Track    @relation(fields: [trackId], references: [id])
    trackId     String
    date        DateTime
    rank        Int
    streams     Float

    @@unique([countryName, trackId, date], name: "chartEntryId")
    @@map("RegionChartEntry") // should have been named CountryChartEntry from the start, but I realized later and don't want to break my existing DB for now - note also that this has nothing to do with the Country genre lol
}

model GlobalChartEntry {
    id      String   @id @default(cuid())
    track   Track    @relation(fields: [trackId], references: [id])
    trackId String
    date    DateTime
    rank    Int
    streams Float

    @@unique([trackId, date], name: "chartEntryId")
}
